
# Generated by CodiumAI
from fhiropenapi.factory import ProfiledResourceFactory
from fhiropenapi.fhirpath import FHIRPathNavigator

import requests
import json

import pytest
from unittest.mock import patch, MagicMock
from unittest import TestCase 

class TestGetStructureDefinition(TestCase):

    def setUp(self):
        self.expected_json = {
            'id': 'example',
            'status': 'active',
            'type': 'Observation',
            'name': 'Profile',
            'kind': 'resource',
            'abstract': False,
            'url': 'https://fhir.com/StructureDefinition/fhir-profile',
            
        }
        self.mock_response = MagicMock()
        self.mock_response.json.return_value = self.expected_json
        self.mock_response.raise_for_status = MagicMock()
        
    def test_get_structure_definition_from_canonical_url(self):
        profile_url = "https://fhir.com/StructureDefinition/fhir-profile"
        with patch('requests.get', return_value=self.mock_response):
            factory = ProfiledResourceFactory()
            result = factory.get_structure_definition(profile_url)
            requests.get.assert_called_once_with("https://fhir.com/StructureDefinition-fhir-profile.json")
            assert all([getattr(result, field) == value for field,value in self.expected_json.items()])
            
    def test_get_structure_definition_from_json_url(self):
        profile_url = "https://fhir.com/StructureDefinition-fhir-profile.json"
        with patch('requests.get', return_value=self.mock_response):
            factory = ProfiledResourceFactory()
            result = factory.get_structure_definition(profile_url)
            requests.get.assert_called_once_with("https://fhir.com/StructureDefinition-fhir-profile.json")
            assert all([getattr(result, field) == value for field,value in self.expected_json.items()])
            
