components:
  schemas:
    Quantity:
      type: object
      properties:
        value:
          type: string
          x-fhirpath: $this.value
        system:
          type: string
          x-fhirpath: $this.system
        code:
          type: string
          x-fhirpath: $this.system
    Range:
      type: object
      properties:
        low:
          type: string
          x-fhirpath: $this.low.value
        high:
          type: string
          x-fhirpath: $this.high.value
    Coding:
      type: object
      properties:
        system:
          type: string
          x-fhirpath: $this.system
        code:
          type: string
          x-fhirpath: $this.code
        display:
          type: string
          x-fhirpath: $this.display
        version:
          type: string
          x-fhirpath: $this.version
    Date: 
      type: string
      format: date
      pattern: '^\d{4}-\d{2}-\d{2}$'
    TestSchema:
      title: Condition
      x-fhir-profile: http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-cancer-patient
      properties:
        internalId:
          type: string
        race: 
          $ref: '#/components/schemas/Coding'
          x-binding: http://hl7.org/fhir/us/core/StructureDefinition/us-core-race
          properties:
            system:
              type: string
              x-fhirpath: null
            code:
              type: string
              x-fhirpath: null
            display:
              type: string
              x-fhirpath: Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-race').extension('text').valueString
            version:
              type: string
              x-fhirpath: null
        ethnicity: 
          $ref: '#/components/schemas/Coding'
          x-binding: http://hl7.org/fhir/us/core/ValueSet/omb-ethnicity-category
          properties:
            system:
              type: string
              x-fhirpath: null
            code:
              type: string
              x-fhirpath: null
            display:
              type: string
              x-fhirpath: Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity').extension('text').valueString
            version:
              type: string
              x-fhirpath: null
        gender:
          $ref: '#/components/schemas/Coding'
          x-binding: http://hl7.org/fhir/R4/valueset-administrative-gender.html
          properties:
            system:
              type: string
              x-fhirpath: null
            code:
              type: string
              x-fhirpath: Patient.gender
            display:
              type: string
              x-fhirpath: null
            version:
              type: string
              x-fhirpath: null
        birthsex:
          $ref: '#/components/schemas/Coding'
          x-binding: http://hl7.org/fhir/us/core/ValueSet/birthsex
          properties:
            system:
              type: string
              x-fhirpath: null
            code:
              type: string
              x-fhirpath: Patient.extension('http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex').valueCode
            display:
              type: string
              x-fhirpath: null
            version:
              type: string
              x-fhirpath: null
        names:
          type: array
          x-fhirpath: Patient.name
          items: 
            type: object
            properties:
              givenNames: 
                type: array
                x-fhirpath: $this.given
                items:
                  type: string
              familyName: 
                type: string
                x-fhirpath: $this.family
        birthDate:
          type: string
          x-fhirpath: Patient.birthDate
        contacts:
          type: array
          x-fhirpath: Patient.contact.telecom
          items: 
            type: object
            properties:
              system: 
                type: string
                x-fhirpath: $this.system
              value:
                type: string
                x-fhirpath: $this.value
              use:
                type: string
                x-fhirpath: $this.use
        identifier:
          type: object
          x-fhirpath: Patient.identifier
          properties:
            use: 
              type: string
              x-fhirpath: $this.use
            system: 
              type: string
              x-fhirpath: $this.system
            category: 
              $ref: '#/components/schemas/Coding'
              x-fhirpath: $this.type.coding
            value: 
              type: string
              x-fhirpath: $this.value



openapi: 3.1.0
info:
  title: Test API
  version: 0.0.1
paths:
  /endpoint:
    get:
      responses:
        '200':
          description: Simple response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestSchema'