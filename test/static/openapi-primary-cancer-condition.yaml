components:
  schemas:
    Quantity:
      type: object
      properties:
        value:
          type: string
          x-fhirpath: '%context.value'
        system:
          type: string
          x-fhirpath: '%context.system'
        code:
          type: string
          x-fhirpath: '%context.system'
    Range:
      type: object
      properties:
        low:
          type: string
          x-fhirpath: '%context.low.value'
        high:
          type: string
          x-fhirpath: '%context.high.value'
    Coding:
      type: object
      properties:
        system:
          type: string
          x-fhirpath: '%context.system'
        code:
          type: string
          x-fhirpath: '%context.code'
        display:
          type: string
          x-fhirpath: '%context.display'
        version:
          type: string
          x-fhirpath: '%context.version'
    Date: 
      type: string
      format: date
      pattern: '^\d{4}-\d{2}-\d{2}$'
    TestSchema:
      title: Condition
      x-fhir-profile: http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-primary-cancer-condition
      properties:
        internalId:
          type: string
        status: 
          $ref: '#/components/schemas/Coding'
          x-fhirpath: Condition.clinicalStatus.coding
          x-binding: http://hl7.org/fhir/ValueSet/condition-clinical
        verification: 
          $ref: '#/components/schemas/Coding'
          x-fhirpath: Condition.verificationStatus.coding
          x-binding: http://hl7.org/fhir/ValueSet/condition-clinical
        date:
          $ref: '#/components/schemas/Date'
          x-fhirpath: Condition.extension('http://hl7.org/fhir/StructureDefinition/condition-assertedDate').valueDate
        condition:
          $ref: '#/components/schemas/Coding'
          x-fhirpath: Condition.code.coding
          x-binding: http://hl7.org/fhir/us/mcode/ValueSet/mcode-primary-cancer-disorder-vs
        histology:
          $ref: '#/components/schemas/Coding'
          x-fhirpath: Condition.extension('http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-histology-morphology-behavior').valueCodeableConcept.coding
          x-binding: http://hl7.org/fhir/us/mcode/ValueSet/mcode-histology-morphology-behavior-vs
        topography: 
          $ref: '#/components/schemas/Coding'
          x-fhirpath: Condition.bodySite.coding
          x-binding: http://hl7.org/fhir/us/mcode/ValueSet/mcode-cancer-body-location-vs
        laterality: 
          $ref: '#/components/schemas/Coding'
          x-fhirpath: Condition.bodySite.extension('http://hl7.org/fhir/us/mcode/StructureDefinition/mcode-laterality-qualifier').valueCodeableConcept.coding
          x-binding: http://hl7.org/fhir/us/mcode/ValueSet/mcode-laterality-qualifier-vs        
        patientId:
          type: string
          x-fhirpath: Condition.subject.reference
        onset: 
          $ref: '#/components/schemas/Date'
          x-fhirpath: Condition.onsetDateTime 
        diagnosedBy:
          type: string 
          x-fhirpath: Condition.asserter.reference 

openapi: 3.1.0
info:
  title: Test API
  version: 0.0.1
paths:
  '\endpoint':
    get:
      responses:
        '200':
          description: Simple response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestSchema'
  '\endpoint-multiple':
    get:
      responses:
        '200':
          description: Simple response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TestSchema'